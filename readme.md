# CAT: Context-aware, Graph-based, Commit-level Vulnerability Assessment

<p aligh="center"> This repository contains the code for <b>CAT: Context-aware, Graph-based, Commit-level Vulnerability Detection and Assessment</b>.</p>

# Source Code: https://github.com/vulnerability-assessment-cat/vulnerability-assessment-cat#Instruction_to_Run_CAT
# Demo: https://github.com/vulnerability-assessment-cat/vulnerability-assessment-cat#Demo


## Contents
1. [Introduction](#Introduction)
2. [Dataset](#Dataset)
3. [Requirement](#Requirement)
4. [Instruction_to_Run_CAT](#Instruction_to_Run_CAT)
5. [Demo](#Demo)

## Introduction

Software Vulnerabilities (SVs) are security weaknesses and flaws
that are exploitable in cyber-attacks. Delay in the assessment of
SVs might cause serious consequences due to the unknown impacts
of the SVs on the attacked systems. The state-of-the-art approaches
have been proposed to work directly on the code changes that were
just committed to the repository, and detect any vulnerability and
produce the assessment grades for the detected one. However, those
approaches still suffer low accuracy due to limited representations
for code changes and surrounding contexts.
We propose a Context-aware, Graph-based, Commit-level Vul-
nerability Detection and Assessment Model, CAT, that evaluates
a code change, detects any vulnerability and provides the CVSS
assessment grades for it. To build CAT, we have two key novel
components. First, we design a novel context-aware, graph-based,
representation learning model to learn the contextualized embed-
dings for the code changes that integrate program dependencies and
the surrounding contexts of code changes, facilitating the learning
to detect and assess the vulnerabilities. Second, our automated as-
sessment model, during the assessment of one security aspect, also
considers the impacts of the other aspects by leveraging multi-task
learning (each task learning to assess one aspect) to propagate the
learning from one task to another. Our empirical evaluation shows
that on a vulnerability dataset in C, CAT achieves F-score of 25.5%
and MCC of 26.9% relatively higher than the state-of-the-art model
in vulnerability assessment. In a Java dataset, CAT achieves F-score
of 20.4% and MCC of 28.0% relatively higher as well. It also improves
the vulnerability detection over the existing approaches.

## Dataset

### Preprocessed Dataset

We published our processed C dataset at https://drive.google.com/file/d/1kms3Xr5xkSA6gu9AErbFigsgaTgm25id/view?usp=sharing

Please create a folder named ```data``` under the root folder of CAT, download the dataset, unzip it and put all files in ```./data``` folder.

The Java dataset we used is from ```DeepCVA: Automated Commit-level Vulnerability Assessment with Deep Multi-task Learning``` research. Please reach this research for more information. 

### Use your own dataset

If you want to use your own dataset, please prepare the data as follow:

1. The data are stored in ```data_n.pt```

2. Each ```data_n.pt``` include a set of ```Data``` object from ```torch_geometric```. Each ```Data``` represent a method in a vulnerability introducing commit:
	
	1> ```Data.x = Node_feature_vector```
	
	2> ```Data.y = [label_1, ..., label_7]```
	
	3> ```Data.edge_index = edge_list```
	
Where ```Node_feature_vector``` is ```N*R``` sized torch tensors that represent the node features in the graph, ```N``` is the number of nodes on the graph and ```R``` is the representation vector length.

```edge_list``` is  the matrixs to represent the graph edges for each method. Please refer to ```torch_geometric``` package for more details.

```label_1, ... ,label_7``` are the true labels for seven different vulnerability assessment types.

## Requirement

Install ```Torch``` by following the Instruction from [PyTorch](https://pytorch.org/get-started/locally).

Install ```torch_sparse``` by following the Instruction from [pytorch_sparse](https://github.com/rusty1s/pytorch_sparse).

Install ```torch_geometric``` by following the Instruction from [torch_geometric](https://pytorch-geometric.readthedocs.io/en/latest/notes/installation.html).

See [requirement.txt](https://github.com/Vulnerability-Assessment/vulnerability-assessment/CAT/requirement.txt) for other required packages. 


## Instruction_to_Run_CAT

Download the CAT source code and run ```main.py``` to see the result for our experiment. 

## Demo

Because the dataset that used in our approaches contains big graphs which are huge and the model may take a long time to well trained and tested. To quickly try our model, please download our demo that contains just limited amount of data. 

Demo download: https://drive.google.com/file/d/1ruxgWuAT4DPcSyRue0beooXNi0Y82YAv/view?usp=sharing

Put ```model.pt``` and ```data``` in the root folder of CAT and then run ```run_demo.py``` to see the results.
